<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TonEarn Bot</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="../imgs/non-agressive-fire-fox-head-right-side-view-.png">
</head>
<body>
  <div class="container">
    <!-- –®–∞–ø–∫–∞ -->
    <header>
      <div class="profile">
        <img src="imgs/non-agressive-fire-fox-head-right-side-view-.png" alt="Profile" class="profile-icon">
        <div class="profile-info">
          <span class="username">User</span>
          <span class="balance">0.00 TON</span>
        </div>
      </div>
      <button id="connectWallet">üîó Connect Wallet</button>
    </header>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä -->
    <div class="progress-section">
      <h2>–£—Ä–æ–≤–µ–Ω—å 0</h2>
      <div class="progress-bar">
        <div class="progress" style="width: 75%;"></div>
      </div>
      <p class="progress-text">75% –¥–æ —É—Ä–æ–≤–Ω—è 1 (+0.1 TON)</p>
    </div>

    <!-- –ó–∞–¥–∞–Ω–∏—è -->
    <div class="tasks">
      <h2>üéØ –ù–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è</h2>
      <div id="task-list"></div>
    </div>

    <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav>
      <button class="nav-button active">
        <span class="icon"><img src="imgs/home.png" alt=""></span>
        <span class="text">–ì–ª–∞–≤–Ω–∞—è</span>
      </button>
      <button class="nav-button">
        <span class="icon"><img src="imgs/quest.png" alt=""></span>
        <span class="text">–ó–∞–¥–∞–Ω–∏—è</span>
      </button>
      <button class="nav-button">
        <span class="icon"><img src="imgs/referral-icon.png" alt=""></span>
        <span class="text">–†–µ—Ñ–µ—Ä–∞–ª—ã</span>
      </button>
      <button class="nav-button">
        <span class="icon"><img src="imgs/info.png" alt=""></span>
        <span class="text">–ü–æ–º–æ—â—å</span>
      </button>
    </nav>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", async function () {
      let telegramId = 992930870;  // –ü—Ä–∏–º–µ—Ä: –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID –∏–∑ Telegram
      let response = await fetch(`https://lixaradka.github.io/TonFox/user/${telegramId}`);

      let data = await response.json();

      if (!data.error) {
        document.querySelector(".username").textContent = data.username;
        document.querySelector(".balance").textContent = `${data.balance} TON`;
      }

      // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π
      let tasksResponse = await fetch('/tasks');
      let tasks = await tasksResponse.json();

      const taskList = document.getElementById("task-list");
      tasks.forEach(task => {
        const taskCard = document.createElement("div");
        taskCard.classList.add("task-card");
        taskCard.innerHTML = `
          <div class="task-content">
            <h3>${task.title}</h3>
            <p>${task.description}</p>
            <p>–ù–∞–≥—Ä–∞–¥–∞: ${task.reward} TON</p>
          </div>
          <button class="task-button" onclick="completeTask(${telegramId}, ${task.id})">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
        `;
        taskList.appendChild(taskCard);
      });
    });

    async function completeTask(telegramId, taskId) {
      const response = await fetch('/complete_task', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ telegram_id: telegramId, task_id: taskId })
      });
      const data = await response.json();
      alert(`–ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω! –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: ${data.new_balance} TON`);
    }
  </script>
</body>
</html>
